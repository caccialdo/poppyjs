/* Poppy v0.5.0 | (c) 2014 by Arnaud Ceccaldi | MIT License */
!function(){function e(e,t,n,o){return o&&(n=n.bind(o)),e.addEventListener(t,n),{detach:e.removeEventListener.bind(e,t,n)}}function t(e){var t="Microsoft Internet Explorer"===e.appName&&document.documentMode<9,n=/iP(od|hone)/i.test(e.userAgent),o=/Android/i.test(e.userAgent);return t||n||o}function n(){var e,t,n,o=0,i=document.querySelectorAll("body *");for(e=i.length-1;e>=0;e--)t=~~window.getComputedStyle(i[e]).zIndex,t>o&&(o=t,n=i[e]);return{node:n,index:o}}function o(e,t){"function"==typeof e&&e.apply(this,t||[])}function i(e){if(!l)throw new Error("You need to create an instance of Poppy first.");return this.promise=this.create(e),this}function r(e){if(l)return l;if(t(window.navigator))throw new Error("Your browser is not supported.");return e=e||{},this.cfg={theme:e.theme||"default"},this.injectStyle(),this.createOverlay(),this.bind(),s=this.modals={},u=0,l=this,this}var a=i.prototype;a.create=function(e){var t={state:"pending",cb:{f:[],r:[]}},o=this.node=this.render(e);return void 0!==e.value&&(this.input=o.querySelector("input")),s[u++]=this,d.style.zIndex=n().index+1,d.appendChild(o),l.show(),t},a.then=function(e,t){var n=this.promise,i=n.value;switch(n.state){case"pending":return e&&n.cb.f.push(e),t&&n.cb.r.push(t),n;case"fulfilled":return o(e,[i]),n;case"rejected":return o(t),n}},a.getState=function(){return this.promise.state},a.fulfillAll=function(){var e=this.promise;e.state="fulfilled",e.value=this.input?this.input.value:void 0,e.cb.f.forEach(function(t){o(t,[e.value])}),e.cb={f:[],r:[]}},a.rejectAll=function(){var e=this.promise;e.state="rejected",e.cb.r.forEach(o),e.cb={f:[],r:[]}},a.render=function(e){var t,n=document.createElement("div");return n.className=["poppy-modal",e.class].join(" ").trim(),t="<div class='poppy-body'>"+e.body+"</div>"+(void 0===e.value?"":'<input type="text" value="'+e.value+'"/>')+"<div class='poppy-buttons'>"+e.buttons.map(function(e){return'<button data-id="'+u+'" data-action="'+e.action+'">'+e.label+"</button>"}).join("")+"</div>",n.innerHTML=t,n},a.destroy=function(){d.removeChild(this.node)};var c,d,s,u,l,p,f=r.prototype;f.injectStyle=function(){c=document.createElement("style"),c.type="text/css",c.innerHTML=".poppy-overlay{position:fixed;top:0;left:0;right:0;bottom:0}.poppy-overlay *,.poppy-overlay :before,.poppy-overlay :after{box-sizing:border-box}.poppy-overlay .poppy-modal{width:400px;margin:0 auto}.poppy-hidden{display:none;visibility:hidden}",document.head.insertBefore(c,document.head.firstElementChild)},f.createOverlay=function(){d=document.createElement("div"),d.className="poppy-overlay poppy-hidden "+this.cfg.theme,document.body.appendChild(d)},f.bind=function(){p=[e(d,"click",this.onClick,this),e(d,"keydown",this.onKey,this)]},f.onClick=function(e){var t=e.target;"BUTTON"===t.nodeName&&t.parentNode.classList.contains("poppy-buttons")&&this.onButtonClick(t)},f.onButtonClick=function(e){var t=e.getAttribute("data-id"),n=e.getAttribute("data-action"),o=s[t];"ok"===n?o.fulfillAll():"cancel"===n&&o.rejectAll(),this.hide(),o.destroy()},f.onKey=function(e){var t,n=e.target;if("INPUT"===n.nodeName){switch(e.keyCode){case 13:t=n.parentNode.querySelector("[data-action=ok]");break;case 27:t=n.parentNode.querySelector("[data-action=cancel]")}t&&this.onButtonClick(t)}},f.show=function(){d.classList.remove("poppy-hidden")},f.hide=function(){this.somePending()||d.classList.add("poppy-hidden")},f.somePending=function(){return Object.keys(s).some(function(e){return"pending"===s[e].getState()})},f.alert=function(e,t){t=t||"warning";var n={body:e,class:t,buttons:[{label:"Okay",action:"ok"}]};return new i(n)},f.confirm=function(e){var t={body:e,buttons:[{label:"Cancel",action:"cancel"},{label:"Okay",action:"ok"}]};return new i(t)},f.prompt=function(e,t){var n={body:e,value:t,buttons:[{label:"Cancel",action:"cancel"},{label:"Okay",action:"ok"}]};return new i(n)},f.custom=function(e){return new i(e)},f.destroy=function(){p.forEach(function(e){e.detach()}),d.parentNode.removeChild(d),document.head.removeChild(c),c=d=s=u=l=p=void 0},window.Poppy=r}();