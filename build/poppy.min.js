/* Poppy v0.5.0 | (c) 2014 by Arnaud Ceccaldi | MIT License */
!function(){function t(t,e,n,o){return o&&(n=n.bind(o)),t.addEventListener(e,n),{detach:t.removeEventListener.bind(t,e,n)}}function e(t){var e="Microsoft Internet Explorer"===t.appName&&document.documentMode<9,n=/iP(od|hone)/i.test(t.userAgent),o=/Android/i.test(t.userAgent);return e||n||o}function n(){var t,e,n,o=0,i=document.querySelectorAll("body *");for(t=i.length-1;t>=0;t--)e=~~window.getComputedStyle(i[t]).zIndex,e>o&&(o=e,n=i[t]);return{node:n,index:o}}function o(t,e){"function"==typeof t&&t.apply(this,e||[])}function i(t){if(!f)throw new Error("You need to create an instance of Poppy first.");return this.promise=this.create(t),this}function r(){return this}function a(t){return f?f:e(window.navigator)?this.fallback():(t=t||{},this.cfg={theme:t.theme||"default"},this.injectStyle(),this.createOverlay(),this.bind(),l=this.modals={},p=0,f=this,this)}var c=i.prototype;c.create=function(t){var e={state:"pending",cb:{f:[],r:[]}},o=this.node=this.render(t);return void 0!==t.value&&(this.input=o.querySelector("input")),l[p++]=this,s.style.zIndex=n().index+1,s.appendChild(o),f.show(),e},c.then=function(t,e){var n=this.promise,i=n.value;switch(n.state){case"pending":return t&&n.cb.f.push(t),e&&n.cb.r.push(e),n;case"fulfilled":return o(t,[i]),n;case"rejected":return o(e),n}},c.getState=function(){return this.promise.state},c.fulfillAll=function(){var t=this.promise;t.state="fulfilled",t.value=this.input?this.input.value:void 0,t.cb.f.forEach(function(e){o(e,[t.value])}),t.cb={f:[],r:[]}},c.rejectAll=function(){var t=this.promise;t.state="rejected",t.cb.r.forEach(o),t.cb={f:[],r:[]}},c.render=function(t){var e,n=document.createElement("div");return n.className=["poppy-modal",t.class].join(" ").trim(),e="<div class='poppy-body'>"+t.body+"</div>"+(void 0===t.value?"":'<input type="text" value="'+t.value+'"/>')+"<div class='poppy-buttons'>"+t.buttons.map(function(t){return'<button data-id="'+p+'" data-action="'+t.action+'">'+t.label+"</button>"}).join("")+"</div>",n.innerHTML=e,n},c.destroy=function(){s.removeChild(this.node)};var u=r.prototype;u.alert=function(t){return this.value=window.alert(t),this},u.confirm=function(t){return this.value=window.confirm(t),this},u.prompt=function(t,e){return this.value=window.prompt(t,e),this},u.then=function(t,e){var n=this.value,i="string"==typeof n;null===n||n===!1?o(e):o(t,[i?n:void 0])};var d,s,l,p,f,h,y=a.prototype;y.fallback=function(){return f=new r},y.injectStyle=function(){d=document.createElement("style"),d.type="text/css",d.innerHTML=".poppy-overlay{position:fixed;top:0;left:0;right:0;bottom:0}.poppy-overlay *,.poppy-overlay :before,.poppy-overlay :after{box-sizing:border-box}.poppy-overlay .poppy-modal{width:400px;margin:0 auto}.poppy-hidden{display:none;visibility:hidden}",document.head.insertBefore(d,document.head.firstElementChild)},y.createOverlay=function(){s=document.createElement("div"),s.className="poppy-overlay poppy-hidden "+this.cfg.theme,document.body.appendChild(s)},y.bind=function(){h=[t(s,"click",this.onClick,this),t(s,"keydown",this.onKey,this)]},y.onClick=function(t){var e=t.target;"BUTTON"===e.nodeName&&e.parentNode.classList.contains("poppy-buttons")&&this.onButtonClick(e)},y.onButtonClick=function(t){var e=t.getAttribute("data-id"),n=t.getAttribute("data-action"),o=l[e];"ok"===n?o.fulfillAll():"cancel"===n&&o.rejectAll(),this.hide(),o.destroy()},y.onKey=function(t){var e,n=t.target;if("INPUT"===n.nodeName){switch(t.keyCode){case 13:e=n.parentNode.querySelector("[data-action=ok]");break;case 27:e=n.parentNode.querySelector("[data-action=cancel]")}e&&this.onButtonClick(e)}},y.show=function(){s.classList.remove("poppy-hidden")},y.hide=function(){this.somePending()||s.classList.add("poppy-hidden")},y.somePending=function(){return Object.keys(l).some(function(t){return"pending"===l[t].getState()})},y.alert=function(t,e){e=e||"warning";var n={body:t,class:e,buttons:[{label:"Okay",action:"ok"}]};return new i(n)},y.confirm=function(t){var e={body:t,buttons:[{label:"Cancel",action:"cancel"},{label:"Okay",action:"ok"}]};return new i(e)},y.prompt=function(t,e){var n={body:t,value:e,buttons:[{label:"Cancel",action:"cancel"},{label:"Okay",action:"ok"}]};return new i(n)},y.custom=function(t){return new i(t)},y.destroy=function(){h.forEach(function(t){t.detach()}),s.parentNode.removeChild(s),document.head.removeChild(d),d=s=l=p=f=h=void 0},window.Poppy=a}();